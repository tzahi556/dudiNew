
<style>
    .selected {
        background: #03fcca;
    }
</style>

<div class="row" ng-show="!$ctrl.user.IsTafus">
    <div class="col-md-3">
        <comments studentid="$ctrl.selectedStudent" close-callback="$ctrl.commentClose"></comments>

        <reportMonth studentid="$ctrl.selectedStudentForReport"></reportMonth>
        <!-- student data -->
        <form name="studentForm" ng-submit="$ctrl.submit()" novalidate>
            <div class="panel panel-default">
                <div class="panel-heading">
                    {{($ctrl.role=='farmAdminHorse')?'לקוח':'תלמיד '}}
                    <button type="submit" class="btn btn-xs btn-success pull-left" ng-disabled="studentForm.$invalid">שמור</button>
                </div>

                <div class="panel-body" ng-show="$ctrl.IsInstructorBlock">
                    <div class="form-group">
                        <label>מספר לקוח</label>
                        <input type="text" name="idNumber" ng-disabled="true" class="form-control" ng-model="$ctrl.user.ClientNumber" />
                    </div>
                    <div class="form-group">
                        <label>שם פרטי </label>
                        <input type="text" name="firstName" ng-disabled="true" class="form-control" ng-model="$ctrl.user.FirstName" required />
                    </div>
                    <div class="form-group">
                        <label>שם משפחה</label>
                        <input type="text" name="lastName" ng-disabled="true" class="form-control" ng-model="$ctrl.user.LastName" required />
                    </div>
                    <div class="form-group">
                        <label>ת.ז.</label>
                        <input type="text" name="idNumber" ng-disabled="true" class="form-control" ng-model="$ctrl.user.IdNumber" required />
                    </div>
                    <div class="form-group">
                        <label>תאריך לידה</label>
                        <input type="date" name="birthDate" ng-disabled="true" class="form-control" ng-model="$ctrl.user.BirthDate" />
                    </div>
                    <div class="form-group">
                        <label>שם אם</label>
                        <input type="text" name="parentName" ng-disabled="true" class="form-control" ng-model="$ctrl.user.ParentName2" />
                    </div>
                    <div class="form-group">
                        <label>שם אב</label>
                        <input type="text" name="parentName" ng-disabled="true" class="form-control" ng-model="$ctrl.user.ParentName" />
                    </div>
                    <div class="form-group">
                        <label>כתובת</label>
                        <input type="text" name="address" ng-disabled="true" class="form-control" ng-model="$ctrl.user.Address" />
                    </div>
                    <div class="form-group">
                        <label>טלפון</label>
                        <input type="tel" name="phoneNumber" ng-disabled="true" class="form-control" ng-model="$ctrl.user.PhoneNumber" />
                    </div>
                    <div class="form-group">
                        <label>טלפון 2</label>
                        <input type="tel" name="phoneNumber2" ng-disabled="true" class="form-control" ng-model="$ctrl.user.PhoneNumber2" />
                    </div>


                </div>


                <div class="panel-body" ng-show="!$ctrl.IsInstructorBlock">

                    <div class="form-group">
                        <input type="text" name="search" class="form-control" placeholder="חיפוש {{($ctrl.role=='farmAdminHorse')?'לקוח':'תלמיד '}} אחר" ng-model="searchInput" autocomplete="off" />
                        <div ng-show="searchInput" style="border:solid 1px #ddd">

                            <div ng-repeat="s in $ctrl.students  | filter:search | limitTo : 1000 | orderBy:['FirstName','LastName'] ">

                                <div style="cursor:pointer;border-top:1px solid #ddd;padding:5px" ui-sref="student({id:s.Id})">{{s.FirstName}} {{s.LastName}} <span style="color:red" ng-if="s.Active == 'notActive'">(לא פעיל)</span> </div>

                            </div>
                        </div>

                    </div>


                    <div class="form-group hidden">
                        <label>מזהה</label>
                        <input type="number" disabled class="form-control" ng-model="$ctrl.user.Id" />
                    </div>
                    <div class="form-group" ng-if="$ctrl.role!='farmAdminHorse'">
                        <imagepicker model="$ctrl.user.Image" image-label="תמונת {{($ctrl.role=='farmAdminHorse')?'לקוח':'תלמיד '}}" />
                    </div>
                    <div class="form-group">
                        <label>פעיל</label>
                        <select class="form-control" ng-model="$ctrl.user.Active" required>
                            <option value="active">פעיל</option>
                            <option value="notActive">לא פעיל</option>
                        </select>
                    </div>

                    <div class="form-group" ng-if="$ctrl.role!='farmAdminHorse'">

                        <div class="row">

                            <div class="col-md-4">
                                <label><input type="checkbox" ng-model="$ctrl.user.IsLeave" />  עזב? </label>
                            </div>
                            <div class="col-md-8">

                                <input type="date" ng-show="$ctrl.setshowDivLeave()" name="leaveDate" class="form-control" ng-model="$ctrl.user.LeaveDate" />

                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>מספר לקוח</label>
                        <input type="text" name="idNumber" class="form-control" ng-model="$ctrl.user.ClientNumber" />
                    </div>

                    <div class="form-group" ng-if="$ctrl.role!='farmAdminHorse'">
                        <label>שם ארגון</label>
                        <input type="text" name="Organzion" class="form-control" ng-model="$ctrl.user.Organzion" />
                    </div>
                    <div class="form-group">
                        <label>שם פרטי </label>
                        <input type="text" name="firstName" class="form-control" ng-model="$ctrl.user.FirstName" required />
                    </div>
                    <div class="form-group">
                        <label>שם משפחה</label>
                        <input type="text" name="lastName" class="form-control" ng-model="$ctrl.user.LastName" required />
                    </div>
                    <div class="form-group">
                        <label>       {{($ctrl.role!='farmAdminHorse')?"ת.ז":"ת.ז/ח.פ"}}</label>
                        <input type="text" name="idNumber" class="form-control" ng-model="$ctrl.user.IdNumber" required />
                    </div>
                    <div class="form-group" ng-if="$ctrl.role!='farmAdminHorse'">
                        <label>תאריך לידה</label>
                        <input type="date" name="birthDate" class="form-control" ng-model="$ctrl.user.BirthDate" />
                    </div>
                    <div class="form-group" ng-if="$ctrl.role!='farmAdminHorse'">
                        <label>שם אם</label>
                        <input type="text" name="parentName" class="form-control" ng-model="$ctrl.user.ParentName2" />
                    </div>
                    <div class="form-group" ng-if="$ctrl.role!='farmAdminHorse'">
                        <label>שם אב</label>
                        <input type="text" name="parentName" class="form-control" ng-model="$ctrl.user.ParentName" />
                    </div>
                    <div class="form-group">
                        <label>כתובת</label>
                        <input type="text" name="address" class="form-control" ng-model="$ctrl.user.Address" />
                    </div>
                    <div class="form-group">
                        <label>טלפון</label>
                        <input type="tel" name="phoneNumber" class="form-control" ng-model="$ctrl.user.PhoneNumber" />
                    </div>
                    <div class="form-group">
                        <label>טלפון 2</label>
                        <input type="tel" name="phoneNumber2" class="form-control" ng-model="$ctrl.user.PhoneNumber2" />
                    </div>
                    <div class="form-group">
                        <label>אימייל</label>
                        <input type="email" name="email" class="form-control" ng-model="$ctrl.user.AnotherEmail" />
                    </div>

                    <div class="form-group" ng-if="$ctrl.farms.length > 1">
                        <label>חווה</label>
                        <select class="form-control" ng-options="farm.Id as farm.Name for farm in $ctrl.farms" ng-model="$ctrl.user.Farm_Id" required>
                            <option value="">בחר חווה</option>
                        </select>
                    </div>
                    <div class="form-group" ng-if="$ctrl.role!='farmAdminHorse'">
                        <label>סגנון רכיבה</label>
                        <select class="form-control" ng-options="style.id as style.name for style in $ctrl.styles"
                                ng-model="$ctrl.user.Style" ng-change="$ctrl.user.HMO=''"
                                required>
                            <option value="">בחר סגנון רכיבה</option>
                        </select>
                    </div>



                    <div class="form-group" ng-if="$ctrl.user.Style.indexOf('treatment')!=-1 && $ctrl.role!='farmAdminHorse'">
                        <label>קופ"ח</label>
                        <select class="form-control" ng-options="HMO.id as HMO.name for HMO in $ctrl.HMOs"
                                ng-model="$ctrl.user.HMO" required>
                            <option value="">בחר קופת חולים</option>
                        </select>
                    </div>
                    <div class="form-group" ng-if="$ctrl.role!='farmAdminHorse'">
                        <label>חבר נבחרת</label>
                        <select class="form-control" ng-model="$ctrl.user.TeamMember">
                            <option value="">בחר אפשרות</option>
                            <option value="yes">כן</option>
                            <option value="no">לא</option>
                        </select>
                    </div>

                    <div class="form-group" ng-if="$ctrl.role!='farmAdminHorse'">
                        <label>מדריך קבוע</label>
                        <select class="form-control" ng-options="instructor.Id as instructor.FirstName + ' ' +instructor.LastName  for instructor in $ctrl.instructors|filter:{IsMazkirut:0}"
                                ng-model="$ctrl.user.MainInstructorId">
                            <option value="">בחר מדריך</option>
                        </select>
                    </div>




                    <div class="form-group" ng-if="$ctrl.role!='farmAdminHorse'">
                        <label>עלות</label>
                        <input type="number" name="cost" class="form-control" ng-model="$ctrl.user.Cost" ng-change="$ctrl.changeLessonsData()" required />
                    </div>
                    <div class="form-group" ng-if="$ctrl.role!='farmAdminHorse'">
                        <label>סוג תשלום</label>
                        <select class="form-control" ng-model="$ctrl.user.PayType" ng-change="$ctrl.changeLessonsData()" required>
                            <option value="">בחר אפשרות</option>
                            <option value="lessonCost">עלות שיעור</option>
                            <option value="monthCost">עלות חודשית</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>הערות</label>
                        <textarea class="form-control" ng-model="$ctrl.user.Details"></textarea>
                    </div>
                </div>
                <div class="panel-footer" ng-show="!$ctrl.IsInstructorBlock">
                    <button type="submit" class="btn btn-success" ng-disabled="studentForm.$invalid">שמור</button>
                    <button type="button" class="btn btn-default" ng-click="$ctrl.delete()">מחק</button>
                </div>
            </div>
        </form>

    </div>
    <div class="col-md-9">

        <uib-tabset active="active" class="tab-form-demo" ng-show="!$ctrl.IsInstructorBlock">
            <uib-tab index="0" heading="התחשבנות">

                <!-- balance -->
                <div class="panel panel-default">
                    <div class="panel-heading">
                        מצב חשבון
                    </div>
                    <table class="table">
                        <tbody>

                            <tr ng-if="$ctrl.role!='farmAdminHorse'" style="background-color: #fdffe5" ng-show="$ctrl.user.PayType == 'lessonCost'">
                                <td>כמות שיעורים ששולמו סה״כ</td>
                                <td>{{$ctrl.paidLessons}}</td>
                            </tr>
                            <tr ng-if="$ctrl.role!='farmAdminHorse'" style="background-color: #fdffe5" ng-show="$ctrl.user.PayType == 'lessonCost'">
                                <td>כמות שיעורים ששולמו בשנה הנוכחית</td>
                                <td>{{$ctrl.paidLessonsThisYear}}</td>
                            </tr>
                            <tr style="background-color:#ff9933" ng-show="$ctrl.user.PayType == 'lessonCost' && $ctrl.user.HMO && $ctrl.user.HMO.indexOf('maccabi')!=-1">
                                <td>כמות שיעורים בהתחייבות מכבי בשנה הנוכחית</td>
                                <td>{{$ctrl.commitmentLessonsThisYear}}</td>
                            </tr>

                            <tr style="background-color:#ff9933" ng-show="$ctrl.user.PayType == 'lessonCost' && $ctrl.user.HMO && $ctrl.user.HMO.indexOf('maccabi')!=-1">
                                <td>יתרת שיעורים מכבי</td>
                                <td style="direction:ltr;text-align:right;">{{$ctrl.commitmentLessons}}</td>
                            </tr>


                            <tr ng-if="$ctrl.role!='farmAdminHorse'" style="background-color: #fdffe5" ng-show="$ctrl.user.PayType == 'lessonCost'">
                                <td>יתרת שיעורים</td>
                                <td style="direction:ltr;text-align:right;">{{$ctrl.creditPaidLessons}}</td>
                            </tr>

                            <tr ng-if="$ctrl.role!='farmAdminHorse'" style="background-color: #ebffe5" ng-show="$ctrl.user.PayType != 'lessonCost'">
                                <td>כמות חודשים שולמו</td>
                                <td>{{$ctrl.paidMonths}}</td>
                            </tr>
                            <tr ng-if="$ctrl.role!='farmAdminHorse'" style="background-color: #ebffe5" ng-show="$ctrl.user.PayType != 'lessonCost'">
                                <td>יתרת חודשים</td>
                                <td><span style="display:inline-block;direction:ltr;text-align:right;"> {{$ctrl.creditPaidMonth}}</span></td>
                            </tr>

                            <tr>
                                <td>סה"כ מצב חשבון</td>
                                <td>
                                    <span style="display:inline-block;direction:ltr;text-align:right;" id="dvAccountStatus">{{$ctrl.totalExpensesNoShulam*-1 + $ctrl.unpaidLessons + $ctrl.monthlyBalance}}</span>                                    ש"ח

                                    <button class="btn btn-success btn-xs" style="float:left" ng-click="showDiv = !showDiv">פירוט  </button>

                                </td>

                            </tr>
                            <tr ng-show="showDiv">
                                <td colspan="2" style="border:double 4px gray">
                                    <form name="paymentDetails" style="">

                                        <div class="col-md-12">
                                            <label>שיעורים</label>
                                            <table class="table" border="1" style="font-weight:bold">
                                                <thead>
                                                    <tr>

                                                        <th>הגיע</th>
                                                        <th>לא הגיע, לחייב</th>
                                                        <th>לא הגיע</th>
                                                        <th>לא הגיע, לא לחייב</th>
                                                        <th>דרוש שיעור השלמה</th>

                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr>
                                                        <td>{{$ctrl.getStatusLengthFrom1}}</td>
                                                        <td>{{$ctrl.getStatusLengthFrom2}}</td>
                                                        <td>{{$ctrl.getStatusLengthFrom3}}</td>
                                                        <td>{{$ctrl.getStatusLengthFrom4}}</td>
                                                        <td>{{$ctrl.getStatusLengthFrom5}}</td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>

                                        <div class="col-md-4">
                                            <label>מחירי שיעורים</label>
                                            <table class="table" border="1">
                                                <thead>
                                                    <tr>
                                                        <th>סוג</th>
                                                        <th>כמות</th>
                                                        <th>מחיר</th>
                                                        <th>סה"כ</th>

                                                    </tr>
                                                </thead>
                                                <tbody>


                                                    <tr ng-repeat="lprice in $ctrl.lessReport">
                                                        <td>{{lprice.type==1 ? 'שיעורים' : 'חודשים'}}</td>
                                                        <td>{{lprice.count}}</td>
                                                        <td>{{lprice.price}}</td>
                                                        <td>{{lprice.count * lprice.price}}</td>
                                                    </tr>

                                                    <!--<tr>
                                                        <td>22</td>
                                                        <td>33</td>
                                                        <td>2235</td>
                                                    </tr>-->
                                                    <tr>
                                                        <td></td>
                                                        <td style="font-weight:bold;background-color:burlywood;border-top:1px black solid">{{$ctrl.StudentTotalLessons}}</td>
                                                        <td style="border:0;font-weight:bold;text-align:left">סה"כ עבור שיעורים</td>
                                                        <td style="font-weight:bold;background-color:burlywood;border-top:1px black solid">{{$ctrl.newPrice}}</td>
                                                    </tr>
                                                </tbody>
                                            </table>

                                        </div>

                                        <div class="col-md-4">
                                            <label>חיוב הוצאות אחרות</label>
                                            <table class="table" border="1">
                                                <tr>

                                                    <td style="border:0;font-weight:bold;text-align:left" colspan="2">סך חיוב עבור הוצאות</td>
                                                    <td style="font-weight:bold;background-color:burlywood;border-top:1px black solid">{{$ctrl.totalExpensesShulam + $ctrl.totalExpensesNoShulam}}</td>
                                                </tr>

                                            </table>



                                            <div style="padding:5px;background-color:antiquewhite;font-weight:bold;border:solid 1px gray;border-radius:6px">
                                                <div style="text-align:center;font-weight:bold;font-size:20px;text-decoration:underline">חישוב סופי</div>

                                                <div style="text-align:center;font-weight:bold;font-size:18px;direction:ltr"><span style="color:blue">{{$ctrl.totalPay}}</span> - <span style="color:red">({{$ctrl.totalExpensesShulam + $ctrl.totalExpensesNoShulam}} + {{$ctrl.newPrice}})</span> = <u style="border:solid 1px gray;font-size:24px">{{$ctrl.totalPay - ($ctrl.totalExpensesShulam + $ctrl.totalExpensesNoShulam) - $ctrl.newPrice}}</u></div>

                                                <div style="text-align:center;font-weight:bold;font-size:16px;direction:rtl">
                                                    <span>מצב חשבון</span> =
                                                    <span style="color:red">כמה אני חייב</span> -
                                                    <span style="color:blue">כמה שילמתי</span>

                                                </div>

                                            </div>

                                        </div>

                                        <div class="col-md-4">
                                            <label> כסף ששולם (סה"כ חשבוניות)</label>
                                            <table class="table" border="1">
                                                <thead>
                                                    <tr>

                                                        <th> שיעורים </th>
                                                        <th> חודשים </th>
                                                        <th>סה"כ</th>

                                                    </tr>
                                                </thead>
                                                <tbody>

                                                    <tr>

                                                        <td style="font-weight:bold;">{{$ctrl.paidLessons}}</td>
                                                        <td style="font-weight:bold;">{{$ctrl.paidMonths}}</td>
                                                        <td style="font-weight:bold;background-color:aquamarine;border:solid 1px black">{{$ctrl.totalPay}}</td>
                                                    </tr>
                                                </tbody>
                                            </table>

                                        </div>

                                    </form>
                                </td>

                            </tr>
                        </tbody>
                    </table>
                    <div class="panel-footer">
                        <div>
                            <label>הערות מצב חשבון</label>
                            <textarea style="background-color:#fff778;" class="form-control" ng-model="$ctrl.user.BalanceDetails"></textarea>
                        </div>
                    </div>
                </div>

                <!-- pays -->
                <div class="panel panel-default">
                    <div class="panel-heading">
                        תשלומים
                    </div>


                    <table class="table" expandable>
                        <thead>
                            <tr>
                                <th></th>
                                <th>תאריך</th>
                                <th>סוג מסמך</th>
                                <th>מס' מסמך</th>
                                <th>מסמך אב</th>
                                <th style="width:40%">פירוט עיסקה</th>
                                <th>ח/ש</th>
                                <th>סכום</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody>
                            <!--<tr ng-repeat="payment in $ctrl.payments | orderBy: 'Date':true ">שיניתי -->
                            <tr ng-repeat="payment in $ctrl.payments | orderByDateDesc track by $index " ng-class="{'set-status':$ctrl.setStatusZikuy(payment.doc_type)}">

                                <td><input ng-if="$ctrl.setCheckboxForClose(payment)" type="checkbox" ng-click="" ng-model="payment.SelectedForInvoiceTemp" /></td>


                                <td>{{payment.Date | ildate: 'DD/MM/YYYY'}}</td>
                                <td>{{$ctrl.getHebrewdocType(payment.doc_type)}}</td>

                                <td><a target="_blank" style="color:{{((payment.doc_type=='Kabala' || payment.doc_type=='Mas') && !payment.SelectedForInvoice)?'#990000':''}}" ng-href="{{payment.InvoicePdf}}">{{payment.InvoiceNum}}</a></td>

                                <td><a style="float:right" target="_blank" ng-href="{{payment.ParentInvoicePdf}}">{{payment.ParentInvoiceNum}} </a> <div style="float:right" ng-if="payment.ZikuyNumber"> (<a target="_blank" ng-href="{{payment.ZikuyPdf}}">זיכוי -{{payment.ZikuyNumber}} </a>)</div></td>

                                <td>
                                    {{payment.InvoiceDetails}}
                                    <span ng-if="payment.canceled">(מזוכת: {{payment.canceled}})</span>
                                </td>
                                <td>{{payment.count}}</td>
                                <td style="direction:ltr;text-align:right" ng-if="!payment.InvoiceSumFakeZikuy">{{payment.InvoiceSum}}  </td>
                                <td style="direction:ltr;text-align:right" ng-if="payment.InvoiceSumFakeZikuy">{{payment.InvoiceSumFakeZikuy}}  </td>
                                <td>
                                    <!--<button class="btn btn-xs btn-default" ng-disabled="payment.canceled" ng-if="!payment.InvoicePdf" ng-click="$ctrl.refundPayment(payment)">זיכוי</button>-->
                                    <!-- ng-if="!payment.InvoicePdf" צחי הוריד את -->

                                    <button class="btn btn-xs btn-default" ng-click="$ctrl.removePayment(payment)">
                                        מחיקה
                                    </button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <div class="panel-footer">
                        <button class="btn btn-success" ng-if="!$ctrl.showNewPayment" ng-click="$ctrl.showNewPayment=true;$ctrl.disablBtn=false">הוספת תשלום</button>
                        <form ng-if="$ctrl.showNewPayment" name="paymentForm">
                            <div class="form-group" style="background:{{($ctrl.newPayment.noEazi)?'red':''}}">
                                <label ng-if="$ctrl.user.Farm_Id!=46"><input type="checkbox" ng-click="$ctrl.newPayment.isKabala=false;$ctrl.newPayment.isKabalaTroma=false;$ctrl.newPayment.isMas=false;$ctrl.newPayment.isZikuy=false;" ng-model="$ctrl.newPayment.isMasKabala" /> חשבונית מס קבלה</label>
                                <label><input type="checkbox" ng-click="$ctrl.newPayment.isMasKabala=false;$ctrl.newPayment.isKabalaTroma=false;$ctrl.newPayment.isKabala=false;$ctrl.newPayment.isZikuy=false;" ng-model="$ctrl.newPayment.isMas" /> חשבונית מס</label>
                                <label><input type="checkbox" ng-click="$ctrl.newPayment.isMasKabala=false;$ctrl.newPayment.isKabalaTroma=false;$ctrl.newPayment.isMas=false;$ctrl.newPayment.isZikuy=false;" ng-model="$ctrl.newPayment.isKabala" /> קבלה</label>
                                <label ng-if="$ctrl.user.Farm_Id!=46"><input type="checkbox" ng-click="$ctrl.newPayment.isMasKabala=false;$ctrl.newPayment.isKabala=false;$ctrl.newPayment.isMas=false;$ctrl.newPayment.isZikuy=false;" ng-model="$ctrl.newPayment.isKabalaTroma" /> קבלה על תרומה</label>
                                <label><input type="checkbox" ng-click="$ctrl.newPayment.isMasKabala=false;$ctrl.newPayment.isKabalaTroma=false;$ctrl.newPayment.isMas=false;$ctrl.newPayment.isKabala=false" ng-model="$ctrl.newPayment.isZikuy" /> חשבונית זיכוי</label>

                                <label style="float:left"><input type="checkbox" ng-click="" ng-model="$ctrl.newPayment.noEazi" /> ללא חיבור לאיזיקאונט</label>

                            </div>
                            <div class="form-group">
                                <input class="form-control" type="date" ng-model="$ctrl.newPayment.Date" required />
                            </div>
                            <div class="form-group">
                                <input class="form-control" ng-if="$ctrl.user.PayType == 'lessonCost' && $ctrl.role!='farmAdminHorse'" ng-disabled="$ctrl.newPayment.isMas || $ctrl.newPayment.isZikuy" placeholder="כמות שיעורים" min="0" ng-change="$ctrl.countTotal()"
                                       type="number" ng-model="$ctrl.newPayment.lessons" />
                            </div>

                            <table width="100%" ng-if="$ctrl.user.PayType != 'lessonCost' && $ctrl.role!='farmAdminHorse'" ng-hide="$ctrl.newPayment.isMas || $ctrl.newPayment.isZikuy">
                                <tr>
                                    <td>
                                        מחודש
                                    </td>
                                    <td>
                                        &nbsp;
                                    </td>
                                    <td>
                                        עד חודש

                                    </td>

                                </tr>
                                <tr>
                                    <td>
                                        <div class="form-group">
                                            <input class="form-control" placeholder="חודש" min="0" ng-change="$ctrl.countTotal()"
                                                   type="date" ng-model="$ctrl.newPayment.month" />
                                        </div>
                                    </td>
                                    <td>

                                        &nbsp;
                                    </td>
                                    <td>
                                        <div class="form-group">
                                            <input class="form-control" placeholder="חודש" min="0" ng-change="$ctrl.countTotal()"
                                                   type="date" ng-model="$ctrl.newPayment.untilmonth" />
                                        </div>

                                    </td>

                                </tr>

                            </table>

                            <div class="form-group">
                                <label>בחירת הוצאות אחרות</label>
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <td style="width: 10%">הוספה</td>
                                            <td>פריט</td>
                                            <td>עלות</td>
                                            <td>לתשלום</td>
                                        </tr>
                                    </thead>
                                    <tbody ng-if="!$ctrl.newPayment.isZikuy">
                                        <!--filter: {Paid:'!'} track by $index-->
                                        <tr ng-repeat="expense in $ctrl.expenses | orderByDateDesc " ng-if="(expense.Price+expense.ZikuySum)!=expense.Sum  && (expense.Price + expense.ZikuySum)>0">
                                            <td>
                                                <input type="checkbox" ng-init="expense.Checked=false" ng-click="$ctrl.countTotal()"
                                                       ng-model="expense.Checked" />
                                            </td>
                                            <td>
                                                {{expense.Details}}
                                            </td>
                                            <td>{{expense.Price + expense.ZikuySum}}</td>
                                            <td>{{expense.Price + expense.ZikuySum - expense.Sum}}</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <div class="form-group" ng-if="(!$ctrl.newPayment.isMasKabala && !$ctrl.newPayment.isKabala  && !$ctrl.newPayment.isKabalaTroma && !$ctrl.newPayment.isMas && !$ctrl.newPayment.isZikuy) || $ctrl.newPayment.noEazi">
                                <input class="form-control" placeholder="מספר מסמך" type="text" ng-model="$ctrl.newPayment.InvoiceNum" required />
                            </div>
                            <!--<div class="form-group">
                                <input class="form-control" placeholder="פירוט עסקה" type="text" ng-model="$ctrl.newPayment.InvoiceDetails" />
                            </div>-->
                            <!-- cash -->
                            <div class="form-group" style="border:solid 1px gray;border-radius:5px;padding:10px" >


                                <table class="table">
                                    <tr>
                                        <th>#</th>
                                        <th width="80%">שם הפריט</th>
                                        <th>סכום</th>

                                    </tr>
                                    <tr ng-repeat="total in $ctrl.newPayment.InvoiceDetailsArray">
                                        <td>
                                            {{total.amount}}
                                        </td>
                                        <td>
                                            <input class="form-control" placeholder="פירוט" type="text" ng-model="total.details" required ng-change="$ctrl.changeInvoiceTotal()"/>  

                                        </td>
                                        <td>
                                            <input class="form-control" placeholder="סכום הפריט" type="number" ng-model="total.price" required ng-change="$ctrl.changeInvoiceTotal()" />

                                        </td>

                                    </tr>

                                    <tr>
                                        <td></td>
                                        <td>
                                            <input class="form-control" placeholder="פירוט" type="text" ng-model="$ctrl.newPayment.InvoiceDetails" ng-disabled="$ctrl.newPayment.InvoiceDetailsArray.length>0" required/>


                                        </td>
                                        <td>
                                            <input class="form-control" placeholder="סכום החשבונית" type="number" ng-model="$ctrl.newPayment.InvoiceSum" ng-disabled="$ctrl.newPayment.InvoiceDetailsArray.length>0"  required />
                                        </td>

                                    </tr>

                                </table>
                                

                                <!--ng-change="$ctrl.countTotalByInvoiceSum()"-->
                            </div>
                            <!-- payment type -->
                            <div class="form-group" ng-if="($ctrl.newPayment.isMasKabala || $ctrl.newPayment.isKabala || $ctrl.newPayment.isKabalaTroma) && !$ctrl.newPayment.isMas">
                                <select class="form-control" ng-model="$ctrl.newPayment.payment_type" required>
                                    <option value="">צורת תשלום</option>
                                    <option value="cash">מזומן</option>
                                    <option value="check">צ׳ק</option>
                                    <option value="ashrai" ng-if="$ctrl.newPayment.IsAshrai">סליקה כרטיס אשראי</option>
                                    <option value="token" ng-if="$ctrl.newPayment.IsToken">חיוב בטוקן</option>
                                    <option value="credit card">כרטיס אשראי</option>
                                    <option value="bank transfer">בנק</option>
                                </select>
                            </div>


                            <div class="form-group" ng-if="$ctrl.farm.Meta.farmTags.length>0">
                                <select class="form-control" style="background:yellow" ng-options="tag.tag_id as tag.tag_name for tag in $ctrl.farm.Meta.farmTags" ng-model="$ctrl.tag_id">
                                    <option value="">בחר תגית</option>
                                </select>
                            </div>



                            <!-- check -->

                            <div ng-if="$ctrl.newPayment.payment_type=='check'" style="border:solid 1px gray;border-radius:10px;padding:10px;">

                                <div class="form-group" ng-if="$ctrl.newPayment.payment_type=='check'">
                                    <label> האם חשבונית מס תצא אוטמטית בזמן הפירעון?</label> <input class="" type="checkbox" ng-model="$ctrl.newPayment.Checks[$ctrl.currentCheckindex].checks_auto" />
                                </div>

                                <div class="form-group" ng-if="$ctrl.newPayment.payment_type=='check'">
                                    <input class="form-control" placeholder="שם בנק" type="text" ng-model="$ctrl.newPayment.Checks[$ctrl.currentCheckindex].checks_bank_name" required />
                                </div>
                                <div class="form-group" ng-if="$ctrl.newPayment.payment_type=='check'">
                                    <input class="form-control" placeholder="מספר צ׳ק" type="text" ng-model="$ctrl.newPayment.Checks[$ctrl.currentCheckindex].checks_number" required />
                                </div>
                                <div class="form-group" ng-if="$ctrl.newPayment.payment_type=='check'">
                                    <input class="form-control" placeholder="סכום צ׳ק" type="text" ng-model="$ctrl.newPayment.Checks[$ctrl.currentCheckindex].checks_sum" required />
                                </div>
                                <div class="form-group" ng-if="$ctrl.newPayment.payment_type=='check'">
                                    <input class="form-control" placeholder="תאריך פרעון צ׳ק" type="date" ng-model="$ctrl.newPayment.Checks[$ctrl.currentCheckindex].checks_date" required />
                                </div>

                                <div style="text-align:left">


                                    <div style="float:right;font-weight:bold">צ'ק {{$ctrl.currentCheckindex + 1}}  מתוך  {{$ctrl.checksCount +1}} צ'קים</div>
                                    <button ng-click="$ctrl.addCheck(3)" ng-if="$ctrl.currentCheckindex!=0" type="submit" class="btn btn-primary"> צ'ק קודם</button>
                                    <button ng-click="$ctrl.addCheck(4)" ng-if="$ctrl.checksCount > $ctrl.currentCheckindex" type="submit" class="btn btn-primary">צ'ק הבא</button>
                                    <!--<button ng-click="$ctrl.addCheck(2)" ng-if="$ctrl.currentCheckindex!=0" type="submit" class="btn btn-danger">בטל צ'ק</button>-->
                                    <button ng-click="$ctrl.addCheck(1)" ng-disabled="paymentForm.$invalid ||  $ctrl.currentCheckindex < $ctrl.checksCount " type="submit" class="btn btn-success">הוספ\י צ'ק</button>
                                </div>



                            </div>
                            <br />
                            <!-- bank transfer -->
                            <div class="form-group" ng-if="$ctrl.newPayment.payment_type=='bank transfer'">
                                <input class="form-control" placeholder="שם בנק" type="text" ng-model="$ctrl.newPayment.bt_bank_name" />
                            </div>
                            <div class="form-group" ng-if="$ctrl.newPayment.payment_type=='bank transfer'">
                                <input class="form-control" placeholder="סניף" type="text" ng-model="$ctrl.newPayment.bt_bank_branch" />
                            </div>
                            <div class="form-group" ng-if="$ctrl.newPayment.payment_type=='bank transfer'">
                                <input class="form-control" placeholder="מס׳ חשבון" type="text" ng-model="$ctrl.newPayment.bt_bank_account" />
                            </div>
                            <!-- credit card -->
                            <div class="form-group" ng-if="$ctrl.newPayment.payment_type=='credit card'">
                                <select class="form-control" id="ddlCard" ng-model="$ctrl.newPayment.cc_type" required>
                                    <option value="">סוג הכרטיס</option>
                                    <option value="1">Isracart</option>
                                    <option value="2">Visa</option>
                                    <option value="3">Dainers</option>
                                    <option value="4">American express</option>
                                    <option value="6">Leumi card</option>
                                    <option value="99">Mastercard</option>
                                    <option value="0">אחר</option>
                                </select>
                            </div>
                            <div class="form-group" ng-if="$ctrl.newPayment.payment_type=='credit card' ">
                                <select class="form-control" ng-model="$ctrl.newPayment.cc_deal_type" required>
                                    <option value="">סוג התשלום</option>
                                    <option value="1">רגיל</option>
                                    <option value="2">תשלומים</option>
                                    <option value="3">קרדיט</option>
                                    <option value="4">חיוב נדחה</option>
                                    <option value="5">אחר</option>
                                </select>
                            </div>
                            <div class="form-group" ng-if="$ctrl.newPayment.payment_type=='credit card'">
                                <input class="form-control" placeholder="4 ספרות אחרונות" type="text" ng-model="$ctrl.newPayment.cc_number" required />
                            </div>

                            <div class="form-group" ng-if="$ctrl.newPayment.payment_type=='credit card'">
                                <input class="form-control" placeholder="שם בעל הכרטיס" type="text" ng-model="$ctrl.newPayment.cc_customer_name" required />
                            </div>
                            <div class="form-group" ng-if="$ctrl.newPayment.payment_type=='credit card'">
                                <input class="form-control" placeholder="כמות תשלומים" type="number" ng-model="$ctrl.newPayment.cc_num_of_payments" required />
                            </div>
                            <div class="form-group" ng-if="$ctrl.newPayment.payment_type=='credit card'">
                                <input class="form-control" placeholder="מספר תשלום" type="number" ng-model="$ctrl.newPayment.cc_payment_num" required />
                            </div>
                            <!-- #payment type -->
                            <!--<button ng-click="$ctrl.addPayment()" ng-disabled="paymentForm.$invalid || $ctrl.user.Meta.Cost==0" type="submit" class="btn btn-success">הוספה</button>-->
                            <button ng-click="$ctrl.addPayment()" ng-disabled="$ctrl.disablBtn || (paymentForm.$invalid && $ctrl.getIfanyCheckValid())" type="submit" class="btn btn-success">הפקת חשבונית</button>
                            <button ng-click="$ctrl.cancelToken()" ng-if="$ctrl.newPayment.payment_type=='token' && $ctrl.user.cc_token" type="button" class="btn btn-default">איפוס טוקן</button>
                            <button ng-click="$ctrl.show4($ctrl.user.cc_4_digits)" ng-if="$ctrl.newPayment.payment_type=='token' && $ctrl.user.cc_token" type="button" class="btn btn-default"> הצג 4 ספרות אחרונות</button>



                            <div style="float:left" ng-if="$ctrl.newPayment.payment_type=='token' && $ctrl.user.cc_token">


                                <label style="float:left;margin:1px">רבעוני</label><input class="" style="float:left;margin:5px" type="checkbox" ng-model="$ctrl.user.Rivoni" />
                                <input style="float:left;width:100px" type="number" class="form-control" ng-model="$ctrl.user.DateForMonthlySeq" placeholder="מחזוריות" />

                                <input style="float:left;width:100px" type="number" class="form-control" t.paymen ng-model="$ctrl.user.DateForMonthlySum" placeholder="סכום" />

                                <input style="float:left;width:150px" type="date" class="form-control" ng-model="$ctrl.user.DateForMonthlyPay" placeholder="תאריך" />
                                <label style="float:left;margin:5px">חיוב חודשי לפי תאריך:</label>

                                <button type="button" ng-click="$ctrl.submit()" class="btn btn-success pull-left" ng-disabled="studentForm.$invalid ">שמור</button>
                            </div>


                            <span ng-if="$ctrl.user.Cost==0">עלות השיעור הינה 0, לא ניתן להוסיף תשלום</span>
                        </form>
                    </div>
                </div>

                <!-- HMO commitments -->
                <div class="panel panel-default" ng-if="$ctrl.role!='farmAdminHorse'">
                    <div class="panel-heading">
                        התחייבות קופ"ח
                    </div>
                    <table class="table" expandable>
                        <thead>
                            <tr>
                                <th>קופ"ח</th>
                                <th>כמות שיעורים</th>
                                <th>מספר התחייבות</th>
                                <th>תאריך</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr ng-repeat="commitment in $ctrl.commitments | reverse track by $index">
                                <td>{{commitment.HMO}}</td>
                                <td>{{commitment.Qty}}</td>
                                <td>{{commitment.Number}}</td>
                                <td>{{commitment.Date | ildate: 'DD/MM/YYYY'}}</td>
                                <td><button class="btn btn-xs btn-default" ng-click="$ctrl.removeCommitment(commitment)">הסר</button></td>
                            </tr>
                        </tbody>
                    </table>
                    <div class="panel-footer" ng-show="$ctrl.user.Style.indexOf('treatment')!=-1 && $ctrl.isPrepaid()">
                        <form name="commitmentForm">
                            <div class="form-group">
                                <input class="form-control" placeholder="כמות שיעורים" type="number" ng-model="$ctrl.newCommitment.Qty" required />
                            </div>
                            <div class="form-group">
                                <input type="date" class="form-control" ng-model="$ctrl.newCommitment.Date" required />
                            </div>
                            <div class="form-group">
                                <input class="form-control" placeholder="מספר התחייבות" type="text" ng-model="$ctrl.newCommitment.Number" required />
                            </div>
                            <button ng-click="$ctrl.addCommitment()" ng-disabled="commitmentForm.$invalid" type="submit" class="btn btn-success">הוספה</button>
                        </form>
                    </div>
                </div>

                <!-- expenses -->
                <div class="panel panel-default">
                    <div class="panel-heading">

                        <button style="float:left;margin-right:3px" class=" btn btn-success btn-xs" ng-click="$ctrl.printExtention()"> הדפסת הוצאות </button>
                        <button style="float:left;margin-right:3px" class=" btn btn-primary btn-xs" ng-click="$ctrl.printExcelExpensive()"> הורדה לאקסל </button>




                        הוצאות אחרות
                    </div>
                    <table class="table" expandable>
                        <thead>
                            <tr>
                                <th></th>
                                <th>#</th>
                                <th>זיכוי</th>
                                <th>תאריך</th>
                                <th>תיאור</th>
                                <th>עלות</th>
                                <th>הנחה</th>
                                <th>עלות סופית</th>
                                <th>שולם</th>
                                <th></th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr ng-repeat="expense in $ctrl.expenses | orderByDateDesc track by $index" style=background:{{(expense.BeforePrice<0)?'#ffeeee':''}}>
    <td><input ng-if="$ctrl.newExpense.IsZikuy && expense.BeforePrice>0" type="checkbox" ng-change="$ctrl.setExpensiveZikuy(expense)" ng-model="expense.SelectedForZikuy" /></td>

    <td>{{expense.Id}}</td>
    <td>{{expense.ZikuyNumber}}</td>
    <td>{{expense.Date | ildate: 'DD/MM/YYYY'}}</td>
    <td width="40%">
        {{expense.Details}}
        <span ng-if="expense.Paid">(שולם: {{expense.Paid}})</span>
    </td>

    <td style="direction:ltr;text-align:right">{{expense.BeforePrice}}</td>
    <td> <input type="number" class="" ng-if="expense.BeforePrice>0" ng-model="expense.Discount" ng-change="$ctrl.changeExpense(expense)" placeholder="" style="width:100px" /></td>


    <td style="font-weight:bold;direction:ltr;text-align:right">{{expense.BeforePrice - expense.Discount}}</td>
    <td>{{expense.Sum}}</td>
    <td><button ng-if="expense.BeforePrice<0 && $ctrl.zikuyButton(expense)" class="btn btn-xs btn-primary" ng-click="$ctrl.modalAction(false,expense)">זיכוי</button></td>
    <td><button class="btn btn-xs btn-default" ng-click="$ctrl.removeExpense(expense)">הסר</button></td>
</tr>
                        </tbody>
                    </table>
                    <div class="panel-footer">
                        <form name="expenseForm">
                            <div class="form-group">
                                <input type="date" class="form-control" ng-model="$ctrl.newExpense.Date" placeholder="תאריך" required />
                            </div>
                            <div class="form-group">
                                <select type="text" class="form-control" ng-model="$ctrl.newExpense.IsZikuy">
                                    <option value="" selected="selected">הוצאה רגילה</option>
                                    <option value="true">זיכוי</option>
                                </select>
                            </div>
                            <div class="form-group" ng-if="!$ctrl.newExpense.IsPension">
                                <input type="text" class="form-control" ng-model="$ctrl.newExpense.Details" placeholder="תיאור" required />
                            </div>
                            <div class="form-group">
                                <input type="number" class="form-control" ng-model="$ctrl.newExpense.BeforePrice" placeholder="עלות" required />
                            </div>
                            <button type="submit" class="btn btn-success" ng-click="$ctrl.addExpense()" ng-disabled="expenseForm.$invalid">הוספת הוצאה</button>
                        </form>
                    </div>
                </div>

            </uib-tab>
            <uib-tab index="1" heading="שיעורים" ng-if="$ctrl.role!='farmAdminHorse'">

                <!-- lessons -->
                <div class="panel panel-default">
                    <div class="panel-heading">
                        שיעורים




                        <div style="float:left">

                            <button style="float:left;margin-right:3px" class=" btn btn-success btn-xs" ng-click="$ctrl.AddMultipleLessons()"> הוסיפי שיעורים </button>
                            <input style="width:70px;float:left;height:20px" type="number" ng-model="$ctrl.lessAdd">
                            <label style="float:left;margin-right:3px"> מספר שיעורים להוספה: </label>

                        </div>
                    </div>
                    <table class="table">
                        <thead>
                            <tr>
                                <td colspan="2">
                                    מתאריך:<br>
                                    <input type="date" ng-model="$ctrl.dateFrom">
                                </td>
                                <td colspan="2">
                                    עד תאריך:<br>
                                    <input type="date" ng-model="$ctrl.dateTo">
                                </td>
                                <td>
                                </td>
                                <td colspan="4">
                                    <br>
                                    <button class="btn btn-primary btn-xs" ng-click="showDetails=!showDetails;">{{showDetails ? 'הצג הערות משרד' : 'הצג הערות מדריך'}} </button>
                                    <button style="float:left;margin-right:3px" class=" btn btn-success btn-xs" ng-click="$ctrl.printLessons()"> הדפסה </button>
                                    <button style="float:left;margin-right:3px" class=" btn btn-primary btn-xs" ng-click="$ctrl.printExcel()"> Excel </button>

                                </td>
                            </tr>
                            <tr>
                                <th>מס</th>
                                <th>מדריך</th>
                                <th>סוס</th>
                                <th>התחלה</th>
                                <!--<th ng-if="$ctrl.user.Meta.PayType == 'lessonCost'">מחיר שיעור</th>
                                <th ng-if="$ctrl.user.Meta.PayType != 'lessonCost'">עלות חודשית</th>-->

                                <th>סטטוס</th>
                                <th>הערות  {{showDetails ? ' מדריך ' : ' משרד '}}</th>
                                <th></th>
                                <th style="width:100px">מחיר</th>
                                <th>שולם</th>

                            </tr>
                        </thead>
                        <tbody>
                            <tr ng-repeat="lesson in $ctrl.lessons | orderBy:'start' | dateRange:$ctrl.dateFrom:$ctrl.dateTo " ng-class="{'set-status':$ctrl.setStatus(lesson)}">
                                <td>{{$index+1}}</td>
                                <td>{{$ctrl.getInstructorName(lesson.resourceId)}}</td>
                                <td>{{lesson.horsenames[0]}}</td>

                                <td> {{$ctrl.getDayOfWeek(lesson.start)}}  {{lesson.start | ildate: 'DD/MM/YYYY HH:mm'}}</td>


                                <!--<td>{{lesson.lessPrice}}</td>-->

                                <td>

                                    <select ng-options="status.id as status.name for status in $ctrl.lessonStatuses" ng-init="statusIndex = $ctrl.getStatusIndex(lesson)"
                                            ng-model="lesson.statuses[statusIndex].Status" ng-change="$ctrl.changeLessonsStatus(lesson.statuses[statusIndex].Status,lesson.statuses[statusIndex].Details,lesson.statuses[statusIndex].StudentId,lesson.id,lesson.statuses[statusIndex].IsComplete,lesson,false)">
                                        <option value=""></option>
                                    </select>

                                    <img ng-if="lesson.statuses[statusIndex].IsComplete>2  " src="../../images/replace.jpg" width="24px" />


                                    <span ng-if="$ctrl.user.IsLeave==1 && ($ctrl.user.LeaveDate | ildate: 'DD/MM/YYYY')==(lesson.start | ildate: 'DD/MM/YYYY')" style="color:crimson;font-weight:bold">(עזב)</span>

                                </td>
                                <td>
                                    <!--<input style="width:90%;" type="text" ng-model="lesson.statuses[statusIndex].Details" ng-change="$ctrl.changeLessonsStatus(lesson.statuses[statusIndex].Status,lesson.statuses[statusIndex].Details,lesson.statuses[statusIndex].StudentId,lesson.id)">-->

                                    <textarea rows="1" class="form-control" ng-show="showDetails" placeholder="הערות סטטוס" ng-model="lesson.statuses[statusIndex].Details" ng-change="$ctrl.changeLessonsStatus(lesson.statuses[statusIndex].Status,lesson.statuses[statusIndex].Details,lesson.statuses[statusIndex].StudentId,lesson.id,lesson.statuses[statusIndex].IsComplete,lesson,true,lesson.statuses[statusIndex].OfficeDetails)"></textarea>
                                    <textarea rows="1" class="form-control" ng-show="!showDetails" ng-model="lesson.statuses[statusIndex].OfficeDetails" placeholder="הערות משרד" ng-change="$ctrl.changeLessonsStatus(lesson.statuses[statusIndex].Status,lesson.statuses[statusIndex].Details,lesson.statuses[statusIndex].StudentId,lesson.id,lesson.statuses[statusIndex].IsComplete,lesson,true,lesson.statuses[statusIndex].OfficeDetails)"></textarea>  <!--ng-change="$ctrl.setLessonsDetails(lesson)"-->

                                </td>
                                <td>
                                    <a class="btn btn-success btn-xs" ng-show="showDetails" ng-click="$ctrl.openComments(statusIndex,lesson)" href="">...</a>
                                </td>
                                <td>

                                    <input style="width:100px" type="text" ng-model="lesson.lessprice" ng-disabled="lesson.disable" ng-change="$ctrl.setLessPrice(lesson,$index)">

                                </td>
                                <td>
                                    <i class="fa fa-check-circle-o green" ng-show="lesson.paid" aria-hidden="true"></i>
                                    <button class="btn btn-xs btn-danger" ng-show="!lesson.paid && (lesson.statuses[0].Status=='' || !lesson.statuses[0].Status) " ng-click="$ctrl.removeLesson(lesson)">מחק</button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

            </uib-tab>
            <uib-tab index="2" heading="קבצים" ng-if="$ctrl.role!='farmAdminHorse'">
                <!--student files-->
                <div class="panel panel-default">
                    <div class="panel-heading">
                        קבצים
                    </div>
                    <table class="table">
                        <tbody>
                            <tr ng-repeat="file in $ctrl.files">
                                <td><a ng-href="{{$ctrl.uploadsUri + file.Link}}" target="_blank">{{file.Link}}</a></td>
                                <td><button class="btn btn-xs btn-default" ng-click="$ctrl.removeFile(file.Link)">הסר</button></td>
                            </tr>
                        </tbody>
                    </table>
                    <div class="panel-footer">
                        <input type="file" filename="$ctrl.newFile" filename-callback="$ctrl.uploadFile" />
                    </div>
                </div>

                <!--details text editor-->
                <div class="panel panel-default">
                    <div class="panel-heading">
                        הערות (דו"ח חודשי)
                    </div>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>תאריך</th>
                                <th>טקסט</th>
                               
                            </tr>
                        </thead>
                        <tbody>
                            <tr ng-repeat="detail in $ctrl.monthlyReportHeader">
                                <td>{{detail.Date | date:'MM/yyyy'}}</td>
                                <td> <button ng-click="$ctrl.openReport(detail.Date)" type="submit" class="btn btn-primary btn-xs">פתח דו"ח</button></td>
                                <!--<td><button class="btn btn-danger btn-xs" ng-click="$ctrl.removeTextDetail(detail)">מחיקה</button></td>-->
                            </tr>
                        </tbody>
                    </table>
                    <div class="panel-footer">
                        <!--<div class="form-group">
                            <textarea rows="4" type="text" class="form-control" placeholder="טקסט" ng-model="$ctrl.newTextDetail.Text"></textarea>
                        </div>
                        <div class="form-group">
                            <button class="btn btn-success" ng-click="$ctrl.addTextDetail()">הוספה</button>
                        </div>-->
                    </div>
                </div>


                <div class="panel panel-default">
                    <div class="panel-heading">
                        אינטק
                    </div>
                    <div class="panel-body">
                        <textarea class="form-control" rows="1" ng-model="$ctrl.user.Intek"></textarea>


                    </div>
                </div>

                <div class="panel panel-default">
                    <div class="panel-heading">
                        מטרות על
                    </div>
                    <div class="panel-body">







                        <textarea class="form-control" rows="1" ng-model="$ctrl.user.MatrotAl"></textarea>

                        <div style="padding:3px">
                            <table width="100%" border="1">
                                <tr>
                                    <td colspan="2" style="text-align:center;font-weight:bold; background:#34b7eb;padding:3px;width:100%;border:solid 1px black">
                                        מטרות הטיפול

                                    </td>

                                </tr>
                                <tr>

                                    <td style="font-weight:bold;padding:5px; border-spacing:5px;">
                                        מוטורי:

                                    </td>

                                    <td>
                                        <input style="" class="form-control" type="text" ng-model="$ctrl.user.Motori">

                                    </td>

                                </tr>

                                <tr>
                                    <td style="font-weight:bold;padding:5px; border-spacing:5px;">
                                        תקשורתי:

                                    </td>

                                    <td>
                                        <input style="" class="form-control" type="text" ng-model="$ctrl.user.Tikshorti">

                                    </td>

                                </tr>
                                <tr>
                                    <td style="font-weight:bold;padding:5px; border-spacing:5px;">
                                        ריגשי:

                                    </td>

                                    <td>
                                        <input style="" class="form-control" type="text" ng-model="$ctrl.user.Rigshi">

                                    </td>

                                </tr>

                                <tr>
                                    <td style="font-weight:bold;padding:5px; border-spacing:5px;">
                                        התנהגותי:

                                    </td>

                                    <td>
                                        <input style="" class="form-control" type="text" ng-model="$ctrl.user.Hitnahagoti">

                                    </td>

                                </tr>

                            </table>
                            <br />
                            <table width="100%" border="1">
                                <tr>
                                    <th style="text-align:center;font-weight:bold; background:#34b7eb;">מס' טיפול </th>
                                    <th style="text-align:center;font-weight:bold; background:#34b7eb;">תאריך </th>
                                    <th style="text-align:center;font-weight:bold; background:#34b7eb;">מטפל </th>
                                    <th style="text-align:center;font-weight:bold; background:#34b7eb;">סוס </th>
                                    <th style="text-align:center;font-weight:bold; background:#34b7eb;">מטרות לטיפול זה </th>
                                    <th style="text-align:center;font-weight:bold; background:#34b7eb;">מהלך </th>
                                    <th style="text-align:center;font-weight:bold; background:#34b7eb;">הערות וסטטוס  </th>
                                    <th style="text-align:center;font-weight:bold; background:#34b7eb;width:40%">משוב  </th>

                                </tr>

                                <tr ng-if="!$ctrl.isDateMoreToday(lesson.start)" ng-repeat="lesson in (filtered = ( $ctrl.lessons | orderBy:'-start' ))" <!--ng-class="{'set-status':$ctrl.setStatus(lesson)}-->">

                                <td style="padding:5px; border-spacing:5px;">{{$ctrl.lessons.length - $index}}</td>
                                <td style="padding:5px; border-spacing:5px;">{{$ctrl.getDayOfWeek(lesson.start)}}  {{lesson.start | ildate: 'DD/MM/YYYY HH:mm'}}</td>
                                <td style="padding:5px; border-spacing:5px;">{{$ctrl.getInstructorName(lesson.resourceId)}}</td>
                                <td style="padding:5px; border-spacing:5px;">{{lesson.horsenames[0]}}</td>
                                <td style="padding:5px; border-spacing:5px;">{{lesson.statuses[0].Matarot}}</td>
                                <td style="padding:5px; border-spacing:5px;">{{lesson.statuses[0].Mahalak}}</td>
                                <td style="padding:5px; border-spacing:5px;">{{lesson.statuses[0].HearotStatus}}</td>
                                <td style="padding:5px; border-spacing:5px;">{{lesson.statuses[0].Mashov}}</td>

                                </tr>



                            </table>

                        </div>


                    </div>
                </div>




            </uib-tab>
            <uib-tab index="4" heading="סוסים">
                <!--student files-->
                <div class="panel panel-default">
                    <div class="panel-heading">
                        סוסים
                    </div>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>מזהה</th>
                                <th>שם סוס</th>
                                <th>בעלים</th>
                                <th>תשלום חודשי עבור פנסיון</th>
                                <th>עלות אימון סוס</th>
                                <th>ביטול חיוב אוטמטי</th>
                                <th>תאריך סיום הביטול</th>

                                <th></th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr ng-repeat="horse in $ctrl.userhorses">
                                <td>{{horse.HorseId}}</td>
                                <td><a class="" ui-sref="horse({id:horse.HorseId})"> {{horse.Name}}</a></td>
                                <td><input type="checkbox" ng-model="horse.Owner"></td>
                                <td><input class="table-control" type="number" ng-model="horse.PensionPrice"></td>
                                <td><input class="table-control" type="number" ng-model="horse.TrainingCost"></td>



                                <td><input class="table-control" type="checkbox" ng-model="horse.IsCancelAuto"></td>
                                <td><input class="table-control" type="date" ng-model="horse.UntilCancelTime"></td>
                                <td><button class="btn btn-xs btn-default" ng-click="$ctrl.removeHorse(horse)">הסר</button></td>
                            </tr>
                        </tbody>
                    </table>
                    <div class="panel-footer">
                        <form name="newHorseForm">
                            <div class="form-group">
                                <select class="form-control" ng-options="horse as horse.Name for horse in $ctrl.horses |filter:{Active:'!notActive'}" ng-model="$ctrl.newHorse" required>
                                    <option value="">בחר סוס</option>
                                </select>
                            </div>
                            <button ng-click="$ctrl.addNewHorse()" ng-disabled="newHorseForm.$invalid" type="submit" class="btn btn-success">הוספה</button>
                        </form>
                    </div>
                </div>
            </uib-tab>
            <uib-tab index="5" heading="מעקב">


                <div class="col-md-8">
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            רשימת הערות
                            <button type="submit" class="btn btn-xs btn-success pull-left" ng-click="$ctrl.addMakav()">הוסיפי הערה חדשה</button>
                        </div>
                        <div class="panel-body">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>תאריך רישום</th>
                                        <th>שם עובד</th>
                                        <th>נושא</th>

                                        <th></th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr ng-repeat="ma in $ctrl.makav" ng-click="$ctrl.setMakavDesc(ma,$index)" ng-style="cursor:default" ng-class="
                                          {selected: $index === idSelectedVote}">
                                        <td>{{ma.Date | ildate: 'DD/MM/YYYY'}}</td>
                                        <td>{{ma.UserWrite}}</td>
                                        <td><input class="form-control" type="text" style="width:250px" ng-model="ma.Subject"></td>
                                        <td><button class="btn btn-danger" ng-click="$ctrl.removeMakav(ma,$index)">הסר</button></td>
                                    </tr>
                                </tbody>
                            </table>


                        </div>
                    </div>

                </div>

                <div class="col-md-4">
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            הערות
                        </div>
                        <div class="panel-body">
                            <textarea ng-repeat="ma in $ctrl.makav" ng-show="$index == idSelectedVote" class="form-control" rows="27" ng-model="ma.Desc"></textarea>
                        </div>
                    </div>

                </div>








            </uib-tab>

        </uib-tabset>

        <uib-tabset active="active2" class="tab-form-demo" ng-show="$ctrl.IsInstructorBlock">

            <uib-tab index="0" heading="קבצים">
                <!--student files-->
                <div class="panel panel-default">
                    <div class="panel-heading">
                        קבצים
                    </div>
                    <table class="table">
                        <tbody>
                            <tr ng-repeat="file in $ctrl.files">
                                <td><a ng-href="{{$ctrl.uploadsUri + file.Link}}" target="_blank">{{file.Link}}</a></td>
                                <td><button class="btn btn-xs btn-default" ng-click="$ctrl.removeFile(file.Link)">הסר</button></td>
                            </tr>
                        </tbody>
                    </table>
                    <div class="panel-footer">
                        <input type="file" filename="$ctrl.newFile" filename-callback="$ctrl.uploadFile" />
                    </div>
                </div>

                <!--details text editor-->
                <div class="panel panel-default">
                    <div class="panel-heading">
                        הערות (דו"ח חודשי)
                    </div>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>תאריך</th>
                                <th>טקסט</th>
                                <!--<th>מחיקה</th>-->
                            </tr>
                        </thead>
                        <tbody>
                            <tr ng-repeat="detail in $ctrl.monthlyReportHeader">
                                <td>{{detail.Date | date:'MM/yyyy'}}</td>
                                <td> <button ng-click="$ctrl.openReport(detail.Date)" type="submit" class="btn btn-primary btn-xs">פתח דו"ח</button></td>
                                <!--<td><button class="btn btn-danger btn-xs" ng-click="$ctrl.removeTextDetail(detail)">מחיקה</button></td>-->
                            </tr>
                        </tbody>
                    </table>
                    <div class="panel-footer">
                        <!--<div class="form-group">
                            <textarea rows="4" type="text" class="form-control" placeholder="טקסט" ng-model="$ctrl.newTextDetail.Text"></textarea>
                        </div>
                        <div class="form-group">
                            <button class="btn btn-success" ng-click="$ctrl.addTextDetail()">הוספה</button>
                        </div>-->
                    </div>
                </div>


                <div class="panel panel-default">
                    <div class="panel-heading">
                        אינטק
                    </div>
                    <div class="panel-body">
                        <textarea class="form-control" rows="7" ng-model="$ctrl.user.Intek"></textarea>


                    </div>
                </div>

                <div class="panel panel-default">
                    <div class="panel-heading">
                        מטרות על
                    </div>
                    <div class="panel-body">
                        <textarea class="form-control" rows="7" ng-model="$ctrl.user.MatrotAl"></textarea>


                    </div>
                </div>




            </uib-tab>


        </uib-tabset>





    </div>






    <div class="modal fade" id="modalAddRemove" style="z-index:50000" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="myModalLabel">האם למחוק גם אירועים עתידיים?</h4>
                </div>
                <div class="modal-body">
                    <button type="button" class="btn btn-primary" ng-click="$ctrl.modalRemoveAdd(false)" data-dismiss="modal" id="dvAppendHad">הסר תלמיד באופן חד פעמי</button>
                    <button type="button" class="btn btn-primary" ng-click="$ctrl.modalRemoveAdd(true)" data-dismiss="modal" id="dvAppendTz">הסר תלמיד לכל השיעורים עתידיים </button>
                </div>
            </div>
        </div>
    </div>


    <div class="modal fade" id="modalZikuy" style="z-index:50000" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="myModalLabel">זיכוי הוצאות אחרות</h4>
                </div>
                <div class="modal-body">


                    <table class="table">
                        <thead>
                            <tr>
                                <th></th>
                                <th>#</th>

                                <th>תאריך</th>
                                <th>תיאור</th>
                               
                                <th>עלות סופית</th>

                                <th></th>

                            </tr>
                        </thead>
                        <tbody>
                            <tr ng-if="expense.BeforePrice > 0" ng-repeat="expense in $ctrl.zikuyButton() | orderByDateDesc track by $index">
                                <td><input type="checkbox" ng-change="$ctrl.setExpensiveZikuy(expense)" ng-model="expense.SelectedForZikuy" /></td>

                                <td>{{expense.Id}}</td>

                                <td>{{expense.Date | ildate: 'DD/MM/YYYY'}}</td>
                                <td width="40%">
                                    {{expense.Details}}
                                    <span ng-if="expense.Paid">(שולם: {{expense.Paid}})</span>
                                </td>

                              
                                <td style="font-weight:bold;direction:ltr;text-align:right">{{expense.BeforePrice - expense.Discount}}</td>
                                

                            </tr>
                        </tbody>
                    </table>


                    <div style="text-align:left">

                       
                        <button type="button" class="btn btn-primary" ng-click="$ctrl.modalAction(1)" data-dismiss="modal">זכה הוצאות אחרות</button>
                        <button type="button" class="btn btn-danger" ng-click="$ctrl.modalAction(2)" data-dismiss="modal">ביטול </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>